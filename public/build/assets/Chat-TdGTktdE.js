import{b as $,r as a,a as G,j as e,H as Q}from"./app-BztPSXfc.js";import{N as X,F as Z}from"./Footer-BZlGrAOc.js";import{A as ee,S as P}from"./AttachFile-DOzjA6vf.js";import{V as te}from"./VideoFile-C0qPxGvm.js";import{M as se}from"./MoreVert-qp-PgQU0.js";import{A as re}from"./Add-C4l-l6ej.js";import{C as oe}from"./Close-B-15TmdB.js";import{B as o,T as n}from"./Box-BNDCmtGm.js";import{C as ie}from"./Container-OPsniF9m.js";import{R as ne,C as L}from"./Row-BAtm_SPs.js";import{C as E,a as U}from"./CardContent-Btej2N3x.js";import{B as C,S as l,M as ae,P as le}from"./Stack-CckH4aNe.js";import{A as S,I as y,M}from"./KeyboardArrowDown-BwBTyLRo.js";import{T as de}from"./TextField-CcFsmalO.js";import{D as ce,a as he,b as xe,c as me}from"./DialogTitle-j0lu7wsC.js";/* empty css            */import"./useFormControl-CH9Vmhrk.js";function Be(){const{url:v}=$(),D=a.useMemo(()=>{const t=v.includes("?")?v.split("?")[1]:"";return new URLSearchParams(t)},[v]),T=a.useRef(null),j=a.useRef(null),[m,p]=a.useState(null),[h,B]=a.useState(""),[x,A]=a.useState([]),[R,I]=a.useState({}),[O,u]=a.useState(!1),[g,f]=a.useState(null),[W]=a.useState([{id:1,name:"Sarah Johnson",email:"sarah.johnson@example.com",avatar:""},{id:2,name:"Michael Chen",email:"michael.chen@example.com",avatar:""},{id:3,name:"Emma Williams",email:"emma.williams@example.com",avatar:""},{id:4,name:"David Brown",email:"david.brown@example.com",avatar:""},{id:5,name:"Lisa Anderson",email:"lisa.anderson@example.com",avatar:""}]),[b,F]=a.useState([{id:1,hostName:"Sarah Johnson",hostAvatar:"",property:"Luxury Beachfront Villa",lastMessage:"hey ðŸ‘‹ hey...",lastMessageTime:new Date("2025-01-20T10:30:00"),unreadCount:2,messages:[{id:1,text:"Hello! I have a question about the property.",sender:"customer",timestamp:new Date("2025-01-20T09:00:00"),read:!0},{id:2,text:"Hi! I'd be happy to help. What would you like to know?",sender:"host",timestamp:new Date("2025-01-20T09:05:00"),read:!0},{id:3,text:"Is the property pet-friendly?",sender:"customer",timestamp:new Date("2025-01-20T09:10:00"),read:!0},{id:4,text:"Yes, pets are allowed with prior notification.",sender:"host",timestamp:new Date("2025-01-20T09:15:00"),read:!0},{id:5,text:"hey ðŸ‘‹ hey",sender:"customer",timestamp:new Date("2025-01-20T10:30:00"),read:!1}]},{id:2,hostName:"Michael Chen",hostAvatar:"",property:"Modern Downtown Apartment",lastMessage:"hey",lastMessageTime:new Date("2025-01-19T14:20:00"),unreadCount:0,messages:[{id:1,text:"What time is check-in?",sender:"customer",timestamp:new Date("2025-01-19T14:00:00"),read:!0},{id:2,text:"The check-in time is flexible.",sender:"host",timestamp:new Date("2025-01-19T14:20:00"),read:!0},{id:3,text:"hey",sender:"customer",timestamp:new Date("2025-01-19T14:25:00"),read:!0}]},{id:3,hostName:"Emma Williams",hostAvatar:"",property:"Cozy Mountain Cabin",lastMessage:"ðŸ“Ž image",lastMessageTime:new Date("2025-01-18T16:45:00"),unreadCount:0,messages:[{id:1,sender:"host",timestamp:new Date("2025-01-18T16:45:00"),read:!0,files:[{id:"1",type:"image",url:"/images/popular-stay-1.svg",name:"property-image.jpg",size:245e3}]}]}]),c=b.find(t=>t.id===m),V=()=>{T.current?.scrollIntoView({behavior:"smooth"})};a.useEffect(()=>{const t=D.get("host"),r=D.get("property");if(t&&r){const i=b.find(s=>s.hostName===t&&s.property===r);if(i)p(i.id);else{const s={id:Date.now(),hostName:t,hostAvatar:"",property:r,lastMessage:"",lastMessageTime:new Date,unreadCount:0,messages:[]};F(d=>[s,...d]),p(s.id)}G.visit("/chat")}},[D]),a.useEffect(()=>{c&&V()},[c?.messages]);const Y=t=>{if(t.target.files){const r=Array.from(t.target.files);A(i=>[...i,...r])}},_=t=>{A(r=>r.filter((i,s)=>s!==t))},k=()=>{if(!h.trim()&&x.length===0||!m)return;const t=x.map((s,d)=>({id:`file-${Date.now()}-${d}`,type:s.type.startsWith("image/")?"image":"video",url:URL.createObjectURL(s),name:s.name,size:s.size})),r={id:Date.now(),text:h.trim()||void 0,sender:"customer",timestamp:new Date,read:!1,files:t.length>0?t:void 0};let i=h.trim()||"";x.length>0&&!h.trim()&&(i=""),F(s=>s.map(d=>d.id===m?{...d,messages:[...d.messages,r],lastMessage:i,lastMessageTime:new Date}:d)),B(""),A([]),j.current&&(j.current.value="")},K=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),k())},z=t=>t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),N=t=>{const r=new Date,i=new Date(r);return i.setDate(i.getDate()-1),t.toDateString()===r.toDateString()?"Today":t.toDateString()===i.toDateString()?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},q=(t,r)=>{I(i=>({...i,[t]:r.currentTarget}))},w=t=>{I(r=>({...r,[t]:null}))},J=t=>{const r=W.find(i=>i.id===t);if(r){const i=b.find(s=>s.hostName===r.name);if(i)p(i.id);else{const s={id:Date.now(),hostName:r.name,hostAvatar:r.avatar,property:"New Property",lastMessage:"",lastMessageTime:new Date,unreadCount:0,messages:[]};F(d=>[s,...d]),p(s.id)}}u(!1),f(null)},H=t=>t.lastMessage.includes("image")||t.lastMessage.includes("video")?"":t.lastMessage;return e.jsxs(o,{children:[e.jsx(Q,{title:"Messages"}),e.jsx(X,{}),e.jsx(o,{sx:{minHeight:"100vh",bgcolor:"#FFFFFF",py:4},children:e.jsxs(ie,{children:[e.jsxs(o,{sx:{mb:4},children:[e.jsx(n,{variant:"h2",sx:{fontSize:"2.5rem",fontWeight:800,color:"#222222",mb:1},children:"Messages"}),e.jsx(n,{variant:"body1",sx:{color:"#717171",fontSize:"1rem"},children:"Chat with your hosts"})]}),e.jsxs(ne,{children:[e.jsx(L,{xs:12,md:4,lg:3,children:e.jsxs(E,{elevation:0,sx:{border:"1px solid #E5E7EB",borderRadius:2,height:"calc(100vh - 250px)",overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsx(U,{sx:{p:2},children:e.jsx(C,{variant:"contained",startIcon:e.jsx(re,{}),fullWidth:!0,onClick:()=>u(!0),sx:{bgcolor:"#AD542D",textTransform:"none",fontWeight:700,borderRadius:2,mb:2,py:1.5,"&:hover":{bgcolor:"#78381C"}},children:"Start Conversation"})}),e.jsx(U,{sx:{p:0,flex:1,overflowY:"auto"},children:b.map(t=>e.jsx(o,{onClick:()=>{p(t.id),F(r=>r.map(i=>i.id===t.id?{...i,unreadCount:0,messages:i.messages.map(s=>({...s,read:!0}))}:i))},sx:{p:2,borderBottom:"1px solid #E5E7EB",cursor:"pointer",bgcolor:m===t.id?"#FFF5F7":"transparent",position:"relative","&:hover":{bgcolor:m===t.id?"#FFF5F7":"#F9FAFB"}},children:e.jsxs(l,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(S,{sx:{bgcolor:"#AD542D",width:48,height:48},children:t.hostName.charAt(0)}),e.jsxs(o,{sx:{flex:1,minWidth:0},children:[e.jsxs(l,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:.5},children:[e.jsx(n,{variant:"subtitle2",sx:{fontWeight:700,color:"#222222"},children:t.hostName}),e.jsxs(l,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(n,{variant:"caption",sx:{color:"#9CA3AF"},children:N(t.lastMessageTime)}),e.jsx(y,{size:"small",onClick:r=>{r.stopPropagation(),q(t.id,r)},sx:{p:.5},children:e.jsx(se,{sx:{fontSize:18,color:"#9CA3AF"}})}),e.jsxs(ae,{anchorEl:R[t.id],open:!!R[t.id],onClose:()=>w(t.id),children:[e.jsx(M,{onClick:()=>w(t.id),children:"Archive"}),e.jsx(M,{onClick:()=>w(t.id),children:"Delete"}),e.jsx(M,{onClick:()=>w(t.id),children:"Mute"})]})]})]}),e.jsxs(l,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[H(t)&&e.jsx(n,{variant:"body2",sx:{color:t.unreadCount>0?"#222222":"#717171",fontWeight:t.unreadCount>0?600:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,mr:1},children:H(t)}),t.unreadCount>0&&e.jsx(o,{sx:{bgcolor:"#AD542D",color:"#FFFFFF",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:700},children:t.unreadCount})]})]})]})},t.id))})]})}),e.jsx(L,{xs:12,md:8,lg:9,children:c?e.jsxs(E,{elevation:0,sx:{border:"1px solid #E5E7EB",borderRadius:2,height:"calc(100vh - 250px)",display:"flex",flexDirection:"column"},children:[e.jsx(o,{sx:{p:2,borderBottom:"1px solid #E5E7EB"},children:e.jsx(l,{direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(S,{sx:{bgcolor:"#AD542D",width:40,height:40},children:c.hostName.charAt(0)}),e.jsxs(o,{children:[e.jsx(n,{variant:"subtitle1",sx:{fontWeight:700,color:"#222222"},children:c.hostName}),e.jsx(n,{variant:"caption",sx:{color:"#717171"},children:c.property})]})]})})}),e.jsxs(o,{sx:{flex:1,overflowY:"auto",p:2,bgcolor:"#F9FAFB"},children:[c.messages.map((t,r)=>{const i=r===0||new Date(t.timestamp).toDateString()!==new Date(c.messages[r-1].timestamp).toDateString();return e.jsxs(o,{children:[i&&e.jsx(o,{sx:{textAlign:"center",my:2},children:e.jsx(n,{variant:"caption",sx:{color:"#9CA3AF",bgcolor:"#F9FAFB",px:2,py:.5,borderRadius:1},children:N(t.timestamp)})}),e.jsx(l,{direction:"row",justifyContent:t.sender==="customer"?"flex-end":"flex-start",sx:{mb:1.5},children:t.files&&t.files.length>0&&!t.text?e.jsxs(o,{sx:{maxWidth:"70%",position:"relative"},children:[e.jsx(l,{spacing:1,children:t.files.map(s=>e.jsx(o,{sx:{position:"relative"},children:s.type==="image"?e.jsx(o,{component:"img",src:s.url,alt:s.name,sx:{maxWidth:"100%",maxHeight:300,borderRadius:2,objectFit:"cover",cursor:"pointer",display:"block"},onClick:()=>window.open(s.url,"_blank")}):e.jsx(o,{sx:{borderRadius:2,overflow:"hidden",maxHeight:300},children:e.jsx("video",{src:s.url,style:{maxWidth:"100%",maxHeight:300,display:"block"},controls:!0})})},s.id))}),e.jsx(n,{variant:"caption",sx:{color:"#9CA3AF",fontSize:"0.7rem",display:"block",mt:.5,textAlign:t.sender==="customer"?"right":"left"},children:z(t.timestamp)})]}):e.jsxs(le,{elevation:0,sx:{p:1.5,maxWidth:"70%",bgcolor:t.sender==="customer"?"#AD542D":"#FFFFFF",color:t.sender==="customer"?"#FFFFFF":"#222222",borderRadius:2,border:t.sender==="host"?"1px solid #E5E7EB":"none"},children:[t.files&&t.files.length>0&&e.jsx(l,{spacing:1,sx:{mb:t.text?1:0},children:t.files.map(s=>e.jsx(o,{children:s.type==="image"?e.jsx(o,{component:"img",src:s.url,alt:s.name,sx:{maxWidth:"100%",maxHeight:300,borderRadius:1,objectFit:"cover",cursor:"pointer"},onClick:()=>window.open(s.url,"_blank")}):e.jsx(o,{sx:{position:"relative",bgcolor:"rgba(0,0,0,0.5)",borderRadius:1,overflow:"hidden",minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("video",{src:s.url,style:{maxWidth:"100%",maxHeight:300,borderRadius:4},controls:!0})})},s.id))}),t.text&&e.jsx(n,{variant:"body2",sx:{mb:.5},children:t.text}),e.jsx(n,{variant:"caption",sx:{color:t.sender==="customer"?"rgba(255,255,255,0.7)":"#9CA3AF",fontSize:"0.7rem"},children:z(t.timestamp)})]})})]},t.id)}),e.jsx("div",{ref:T})]}),x.length>0&&e.jsx(o,{sx:{p:2,borderTop:"1px solid #E5E7EB",bgcolor:"#FFFFFF"},children:e.jsx(l,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:x.map((t,r)=>e.jsxs(o,{sx:{position:"relative",border:"1px solid #E5E7EB",borderRadius:1,overflow:"hidden",width:80,height:80},children:[t.type.startsWith("image/")?e.jsx(o,{component:"img",src:URL.createObjectURL(t),alt:t.name,sx:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(o,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#F9FAFB"},children:e.jsx(te,{sx:{fontSize:32,color:"#717171"}})}),e.jsx(y,{size:"small",onClick:()=>_(r),sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(0,0,0,0.5)",color:"#FFFFFF",width:20,height:20,"&:hover":{bgcolor:"rgba(0,0,0,0.7)"}},children:"Ã—"})]},r))})}),e.jsx(o,{sx:{p:2,borderTop:"1px solid #E5E7EB"},children:e.jsxs(l,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx("input",{type:"file",ref:j,onChange:Y,accept:"image/*,video/*",multiple:!0,style:{display:"none"}}),e.jsx(y,{onClick:()=>j.current?.click(),sx:{border:"1px solid #E5E7EB",borderRadius:2,width:40,height:40,color:"#717171","&:hover":{bgcolor:"#F9FAFB",borderColor:"#AD542D"}},children:e.jsx(ee,{})}),e.jsx(de,{fullWidth:!0,placeholder:"Type a message...",value:h,onChange:t=>B(t.target.value),onKeyPress:K,multiline:!0,maxRows:4,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:2,bgcolor:"#FFFFFF","& fieldset":{borderColor:"#E5E7EB"}}}}),e.jsx(C,{variant:"contained",onClick:k,disabled:!h.trim()&&x.length===0,sx:{bgcolor:"#AD542D",borderRadius:2,minWidth:48,height:40,"&:hover":{bgcolor:"#78381C"},"&:disabled":{bgcolor:"#E5E7EB",color:"#9CA3AF"}},children:e.jsx(P,{})})]})})]}):e.jsx(E,{elevation:0,sx:{border:"1px solid #E5E7EB",borderRadius:2,height:"calc(100vh - 250px)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(o,{sx:{textAlign:"center"},children:[e.jsx(o,{sx:{width:80,height:80,borderRadius:"50%",border:"2px solid #E5E7EB",display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:2},children:e.jsx(P,{sx:{fontSize:40,color:"#9CA3AF"}})}),e.jsx(n,{variant:"h6",sx:{color:"#6B7280",mb:1},children:"Select a conversation"}),e.jsx(n,{variant:"body2",sx:{color:"#9CA3AF"},children:"Choose a conversation from the list to start messaging, or create a new one."})]})})})]})]})}),e.jsx(Z,{}),e.jsxs(ce,{open:O,onClose:()=>{u(!1),f(null)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,maxHeight:"80vh"}},children:[e.jsxs(he,{sx:{pb:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:700,color:"#222222"},children:"Start Conversation"}),e.jsx(y,{onClick:()=>{u(!1),f(null)},sx:{color:"#717171"},children:e.jsx(oe,{})})]}),e.jsxs(xe,{sx:{p:0},children:[e.jsx(n,{variant:"body2",sx:{px:3,pb:2,color:"#717171"},children:"Select Participants"}),e.jsx(o,{sx:{maxHeight:"50vh",overflowY:"auto"},children:W.map(t=>e.jsx(o,{onClick:()=>f(t.id),sx:{px:3,py:2,cursor:"pointer",bgcolor:g===t.id?"#FFF5F7":"transparent",borderBottom:"1px solid #E5E7EB","&:hover":{bgcolor:g===t.id?"#FFF5F7":"#F9FAFB"}},children:e.jsxs(l,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(S,{sx:{bgcolor:"#AD542D",width:40,height:40},children:t.name.charAt(0)}),e.jsxs(o,{sx:{flex:1},children:[e.jsx(n,{variant:"subtitle2",sx:{fontWeight:700,color:"#222222",mb:.5},children:t.name}),e.jsx(n,{variant:"body2",sx:{color:"#717171",fontSize:"0.875rem"},children:t.email})]})]})},t.id))})]}),e.jsxs(me,{sx:{p:2,borderTop:"1px solid #E5E7EB"},children:[e.jsx(C,{onClick:()=>{u(!1),f(null)},sx:{color:"#717171",textTransform:"none",fontWeight:600},children:"Cancel"}),e.jsx(C,{onClick:()=>g&&J(g),disabled:!g,variant:"contained",sx:{bgcolor:"#AD542D",textTransform:"none",fontWeight:700,borderRadius:2,px:3,"&:hover":{bgcolor:"#78381C"},"&:disabled":{bgcolor:"#E5E7EB",color:"#9CA3AF"}},children:"Start"})]})]})]})}export{Be as default};
